<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>composables/bucket/JdBucketSelectionRange.ts - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow-eighties.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles/style.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="JdBucketContainerRef.html">JdBucketContainerRef</a><ul class='methods'><li data-type='method'><a href="JdBucketContainerRef.html#addDragItem">addDragItem</a></li><li data-type='method'><a href="JdBucketContainerRef.html#addDragItemToBoundary">addDragItemToBoundary</a></li><li data-type='method'><a href="JdBucketContainerRef.html#createCloneModel">createCloneModel</a></li><li data-type='method'><a href="JdBucketContainerRef.html#destroy">destroy</a></li><li data-type='method'><a href="JdBucketContainerRef.html#dispatchChangeState">dispatchChangeState</a></li><li data-type='method'><a href="JdBucketContainerRef.html#dispatchDropped">dispatchDropped</a></li><li data-type='method'><a href="JdBucketContainerRef.html#findDragItemIndex">findDragItemIndex</a></li><li data-type='method'><a href="JdBucketContainerRef.html#findItemRefByElement">findItemRefByElement</a></li><li data-type='method'><a href="JdBucketContainerRef.html#findItemRefIndex">findItemRefIndex</a></li><li data-type='method'><a href="JdBucketContainerRef.html#flushDragItem">flushDragItem</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getDragItems">getDragItems</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getItemRefs">getItemRefs</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getList">getList</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getMergeCurrentList">getMergeCurrentList</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getMergeInsertList">getMergeInsertList</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getUid">getUid</a></li><li data-type='method'><a href="JdBucketContainerRef.html#isGroupInsertable">isGroupInsertable</a></li><li data-type='method'><a href="JdBucketContainerRef.html#isGroupSame">isGroupSame</a></li><li data-type='method'><a href="JdBucketContainerRef.html#joinItemRef">joinItemRef</a></li><li data-type='method'><a href="JdBucketContainerRef.html#mergeToDrop">mergeToDrop</a></li><li data-type='method'><a href="JdBucketContainerRef.html#observeChangeState">observeChangeState</a></li><li data-type='method'><a href="JdBucketContainerRef.html#observeDropped">observeDropped</a></li><li data-type='method'><a href="JdBucketContainerRef.html#removeByIndex">removeByIndex</a></li><li data-type='method'><a href="JdBucketContainerRef.html#removeByModel">removeByModel</a></li><li data-type='method'><a href="JdBucketContainerRef.html#removeDragItem">removeDragItem</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setDragItem">setDragItem</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setDropBefore">setDropBefore</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setElContainer">setElContainer</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setGroupName">setGroupName</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setLazyStateChangeDelay">setLazyStateChangeDelay</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setList">setList</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setMax">setMax</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setMultiple">setMultiple</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setReceiver">setReceiver</a></li><li data-type='method'><a href="JdBucketContainerRef.html#unjoinItemRef">unjoinItemRef</a></li></ul></li><li><a href="JdBucketItemRef.html">JdBucketItemRef</a><ul class='methods'><li data-type='method'><a href="JdBucketItemRef.html#destroy">destroy</a></li><li data-type='method'><a href="JdBucketItemRef.html#dispatchChangeState">dispatchChangeState</a></li><li data-type='method'><a href="JdBucketItemRef.html#getElBound">getElBound</a></li><li data-type='method'><a href="JdBucketItemRef.html#getUid">getUid</a></li><li data-type='method'><a href="JdBucketItemRef.html#observeChangeState">observeChangeState</a></li><li data-type='method'><a href="JdBucketItemRef.html#setElContainer">setElContainer</a></li><li data-type='method'><a href="JdBucketItemRef.html#setModel">setModel</a></li><li data-type='method'><a href="JdBucketItemRef.html#setSelected">setSelected</a></li></ul></li><li><a href="JdBucketRef.html">JdBucketRef</a><ul class='methods'><li data-type='method'><a href="JdBucketRef.html#dispatchDragChoose">dispatchDragChoose</a></li><li data-type='method'><a href="JdBucketRef.html#dispatchDragEnd">dispatchDragEnd</a></li><li data-type='method'><a href="JdBucketRef.html#dispatchDragStart">dispatchDragStart</a></li><li data-type='method'><a href="JdBucketRef.html#dispatchDragUnchoose">dispatchDragUnchoose</a></li><li data-type='method'><a href="JdBucketRef.html#dispatchRangeSelectionStart">dispatchRangeSelectionStart</a></li><li data-type='method'><a href="JdBucketRef.html#findContainerRefByElement">findContainerRefByElement</a></li><li data-type='method'><a href="JdBucketRef.html#getContainerRefs">getContainerRefs</a></li><li data-type='method'><a href="JdBucketRef.html#joinContainerRef">joinContainerRef</a></li><li data-type='method'><a href="JdBucketRef.html#observeDragger">observeDragger</a></li><li data-type='method'><a href="JdBucketRef.html#observeRangeSelection">observeRangeSelection</a></li><li data-type='method'><a href="JdBucketRef.html#setFallbackIndicate">setFallbackIndicate</a></li><li data-type='method'><a href="JdBucketRef.html#unjoinContainerRef">unjoinContainerRef</a></li></ul></li></ul><h3>Interfaces</h3><ul><li><a href="BucketCloneModel.html">BucketCloneModel</a></li><li><a href="BucketDragChoose.html">BucketDragChoose</a></li><li><a href="BucketDragDrop.html">BucketDragDrop</a></li><li><a href="BucketDragEnd.html">BucketDragEnd</a></li><li><a href="BucketDragSelectionState.html">BucketDragSelectionState</a></li><li><a href="BucketDragStart.html">BucketDragStart</a></li><li><a href="BucketDropBeforeParams.html">BucketDropBeforeParams</a></li><li><a href="BucketEvent.html">BucketEvent</a></li><li><a href="BucketRangeSelectionEvent.html">BucketRangeSelectionEvent</a></li><li><a href="BucketRangeSelectionState.html">BucketRangeSelectionState</a></li><li><a href="BucketSortableEvent.html">BucketSortableEvent</a></li><li><a href="IBucketContainerRef.html">IBucketContainerRef</a></li><li><a href="IBucketItemRef.html">IBucketItemRef</a></li><li><a href="IBucketRef.html">IBucketRef</a></li><li><a href="SelectionBound.html">SelectionBound</a></li><li><a href="SelectionBoundary.html">SelectionBoundary</a></li></ul><h3>Global</h3><ul><li><a href="global.html#BucketEventType">BucketEventType</a></li><li><a href="global.html#createUid">createUid</a></li><li><a href="global.html#getTouchPosition">getTouchPosition</a></li><li><a href="global.html#intersect">intersect</a></li><li><a href="global.html#isIntersect">isIntersect</a></li><li><a href="global.html#isTouchable">isTouchable</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">composables/bucket/JdBucketSelectionRange.ts</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Subject, Observable } from 'rxjs';
import { SelectionBound, SelectionBoundary } from './types';

export class JdBucketSelectionRange {
  constructor() {}

  static _instance: JdBucketSelectionRange | null = null;
  static getInstance() {
    if (!JdBucketSelectionRange._instance) {
      JdBucketSelectionRange._instance = new JdBucketSelectionRange();
    }
    return JdBucketSelectionRange._instance;
  }

  protected startX = 0;
  protected startY = 0;
  protected moveX = 0;
  protected moveY = 0;
  protected subjectBoundary: Subject&lt;SelectionBoundary> = new Subject();
  protected subjectFlushed: Subject&lt;SelectionBoundary> = new Subject();
  protected lastBoundary: SelectionBoundary | null = null;

  /**
   * document
   * @returns {Document}
   */
  getDocument(): Document {
    return window.document;
  }

  /**
   * document mousemove 이벤트 핸들러.
   * @protected
   */
  protected handleSelectionMove = (evt: MouseEvent) => {
    evt.preventDefault();
    this.moveX = evt.x;
    this.moveY = evt.y;
    this.updateBoundary();
  };

  /**
   * document mouseup 이벤트 핸들러.
   * @protected
   */
  protected handleSelectionUp = () => {
    this.endSelection();
  };

  /**
   * document 핸들러 등록
   * @protected
   */
  protected addSelectionHandler() {
    const doc = this.getDocument();
    doc.addEventListener('mousemove', this.handleSelectionMove);
    doc.addEventListener('mouseup', this.handleSelectionUp);
  }

  /**
   * document 핸들러 제거
   * @protected
   */
  protected removeSelectionHandler() {
    const doc = this.getDocument();
    doc.removeEventListener('mousemove', this.handleSelectionMove);
    doc.removeEventListener('mouseup', this.handleSelectionUp);
  }

  /**
   * 옵저버: 바운더리 영역
   * @returns {Observable&lt;SelectionBoundary>}
   */
  observeBoundary(): Observable&lt;SelectionBoundary> {
    return this.subjectBoundary.asObservable();
  }

  /**
   * 옵저버: 바운더리 선택 해제
   * @returns {Observable&lt;SelectionBoundary>}
   */
  observeFlushed(): Observable&lt;SelectionBoundary> {
    return this.subjectFlushed.asObservable();
  }

  /**
   * 알림: 바운더리 영역 변경.
   * @param {SelectionBoundary} boundary
   */
  dispatchBoundary(boundary: SelectionBoundary): void {
    this.lastBoundary = boundary;
    this.subjectBoundary.next(boundary);
  }

  /**
   * 알림: 바운더리 영역 해제.
   */
  dispatchFlushed(): void {
    this.subjectFlushed.next(this.lastBoundary as SelectionBoundary);
  }

  /**
   * 바운더리 영역 변경
   */
  updateBoundary(): void {
    const x1 = this.startX;
    const x2 = this.moveX;
    const y1 = this.startY;
    const y2 = this.moveY;
    const top = Math.min(y1, y2);
    const left = Math.min(x1, x2);
    const width = left ? Math.abs(x1 - x2) : 0;
    const height = top ? Math.abs(y1 - y2) : 0;
    this.dispatchBoundary({
      x: left,
      y: top,
      w: width,
      h: height
    });
  }

  /**
   * 셀렉션 시작.
   * @param {SelectionBound} bound
   */
  startSelection(bound: SelectionBound): void {
    const { x = 0, y = 0 } = bound;
    this.startX = x;
    this.startY = y;
    this.updateBoundary();
    this.removeSelectionHandler();
    this.addSelectionHandler();
  }

  /**
   * 셀렉션 종료.
   */
  endSelection(): void {
    this.startX = 0;
    this.startY = 0;
    this.moveX = 0;
    this.moveY = 0;
    this.flushSelection();
  }

  /**
   * 셀렉션 해제.
   */
  flushSelection(): void {
    this.dispatchFlushed();
    this.removeSelectionHandler();
  }

  /**
   * 해제.
   */
  dispose(): void {
    try {
      this.flushSelection();
      // ...
    } catch (err) {
      console.error(err);
    }
  }

  /**
   * 파기
   */
  destroy(): void {
    try {
      this.flushSelection();
      if (this.subjectBoundary) {
        this.subjectBoundary.unsubscribe();
      }
      if (this.subjectFlushed) {
        this.subjectFlushed.unsubscribe();
      }
      // ...
    } catch (err) {
      console.error(err);
    }
  }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Thu Jul 16 2020 05:43:01 GMT+0000 (Coordinated Universal Time)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
