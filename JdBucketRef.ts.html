<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>JdBucketRef.ts - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow-eighties.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles/style.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="JdBucketContainerRef.html">JdBucketContainerRef</a><ul class='methods'><li data-type='method'><a href="JdBucketContainerRef.html#addDragItem">addDragItem</a></li><li data-type='method'><a href="JdBucketContainerRef.html#addDragItemToBoundary">addDragItemToBoundary</a></li><li data-type='method'><a href="JdBucketContainerRef.html#createCloneModel">createCloneModel</a></li><li data-type='method'><a href="JdBucketContainerRef.html#destroy">destroy</a></li><li data-type='method'><a href="JdBucketContainerRef.html#dispatchChangeState">dispatchChangeState</a></li><li data-type='method'><a href="JdBucketContainerRef.html#dispatchDropped">dispatchDropped</a></li><li data-type='method'><a href="JdBucketContainerRef.html#findDragItemIndex">findDragItemIndex</a></li><li data-type='method'><a href="JdBucketContainerRef.html#findItemRefByElement">findItemRefByElement</a></li><li data-type='method'><a href="JdBucketContainerRef.html#findItemRefIndex">findItemRefIndex</a></li><li data-type='method'><a href="JdBucketContainerRef.html#flushDragItem">flushDragItem</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getDragItems">getDragItems</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getItemRefs">getItemRefs</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getList">getList</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getMergeCurrentList">getMergeCurrentList</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getMergeInsertList">getMergeInsertList</a></li><li data-type='method'><a href="JdBucketContainerRef.html#getUid">getUid</a></li><li data-type='method'><a href="JdBucketContainerRef.html#isGroupInsertable">isGroupInsertable</a></li><li data-type='method'><a href="JdBucketContainerRef.html#isGroupSame">isGroupSame</a></li><li data-type='method'><a href="JdBucketContainerRef.html#joinItemRef">joinItemRef</a></li><li data-type='method'><a href="JdBucketContainerRef.html#mergeToDrop">mergeToDrop</a></li><li data-type='method'><a href="JdBucketContainerRef.html#observeChangeState">observeChangeState</a></li><li data-type='method'><a href="JdBucketContainerRef.html#observeDropped">observeDropped</a></li><li data-type='method'><a href="JdBucketContainerRef.html#removeByIndex">removeByIndex</a></li><li data-type='method'><a href="JdBucketContainerRef.html#removeByModel">removeByModel</a></li><li data-type='method'><a href="JdBucketContainerRef.html#removeDragItem">removeDragItem</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setDragItem">setDragItem</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setDropBefore">setDropBefore</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setElContainer">setElContainer</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setGroupName">setGroupName</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setLazyStateChangeDelay">setLazyStateChangeDelay</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setList">setList</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setMax">setMax</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setMultiple">setMultiple</a></li><li data-type='method'><a href="JdBucketContainerRef.html#setReceiver">setReceiver</a></li><li data-type='method'><a href="JdBucketContainerRef.html#unjoinItemRef">unjoinItemRef</a></li></ul></li><li><a href="JdBucketItemRef.html">JdBucketItemRef</a><ul class='methods'><li data-type='method'><a href="JdBucketItemRef.html#destroy">destroy</a></li><li data-type='method'><a href="JdBucketItemRef.html#dispatchChangeState">dispatchChangeState</a></li><li data-type='method'><a href="JdBucketItemRef.html#getElBound">getElBound</a></li><li data-type='method'><a href="JdBucketItemRef.html#getUid">getUid</a></li><li data-type='method'><a href="JdBucketItemRef.html#observeChangeState">observeChangeState</a></li><li data-type='method'><a href="JdBucketItemRef.html#setElContainer">setElContainer</a></li><li data-type='method'><a href="JdBucketItemRef.html#setModel">setModel</a></li><li data-type='method'><a href="JdBucketItemRef.html#setSelected">setSelected</a></li></ul></li><li><a href="JdBucketRef.html">JdBucketRef</a><ul class='methods'><li data-type='method'><a href="JdBucketRef.html#dispatchDragChoose">dispatchDragChoose</a></li><li data-type='method'><a href="JdBucketRef.html#dispatchDragEnd">dispatchDragEnd</a></li><li data-type='method'><a href="JdBucketRef.html#dispatchDragStart">dispatchDragStart</a></li><li data-type='method'><a href="JdBucketRef.html#dispatchDragUnchoose">dispatchDragUnchoose</a></li><li data-type='method'><a href="JdBucketRef.html#dispatchRangeSelectionStart">dispatchRangeSelectionStart</a></li><li data-type='method'><a href="JdBucketRef.html#findContainerRefByElement">findContainerRefByElement</a></li><li data-type='method'><a href="JdBucketRef.html#getContainerRefs">getContainerRefs</a></li><li data-type='method'><a href="JdBucketRef.html#joinContainerRef">joinContainerRef</a></li><li data-type='method'><a href="JdBucketRef.html#observeDragger">observeDragger</a></li><li data-type='method'><a href="JdBucketRef.html#observeRangeSelection">observeRangeSelection</a></li><li data-type='method'><a href="JdBucketRef.html#setFallbackIndicate">setFallbackIndicate</a></li><li data-type='method'><a href="JdBucketRef.html#unjoinContainerRef">unjoinContainerRef</a></li></ul></li></ul><h3>Interfaces</h3><ul><li><a href="BucketCloneModel.html">BucketCloneModel</a></li><li><a href="BucketDragChoose.html">BucketDragChoose</a></li><li><a href="BucketDragDrop.html">BucketDragDrop</a></li><li><a href="BucketDragEnd.html">BucketDragEnd</a></li><li><a href="BucketDragSelectionState.html">BucketDragSelectionState</a></li><li><a href="BucketDragStart.html">BucketDragStart</a></li><li><a href="BucketDropBeforeParams.html">BucketDropBeforeParams</a></li><li><a href="BucketEvent.html">BucketEvent</a></li><li><a href="BucketRangeSelectionEvent.html">BucketRangeSelectionEvent</a></li><li><a href="BucketRangeSelectionState.html">BucketRangeSelectionState</a></li><li><a href="BucketSortableEvent.html">BucketSortableEvent</a></li><li><a href="IBucketContainerRef.html">IBucketContainerRef</a></li><li><a href="IBucketItemRef.html">IBucketItemRef</a></li><li><a href="IBucketRef.html">IBucketRef</a></li><li><a href="SelectionBound.html">SelectionBound</a></li><li><a href="SelectionBoundary.html">SelectionBoundary</a></li></ul><h3>Global</h3><ul><li><a href="global.html#BucketEventType">BucketEventType</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">JdBucketRef.ts</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Subject, Observable } from 'rxjs';
import {
  BucketEventType,
  BucketDragStart,
  BucketEvent,
  BucketDragEnd,
  IBucketContainerRef,
  IBucketRef,
  BucketDragChoose,
  BucketRangeSelectionEvent
} from './types';

/**
 * 버킷 최상위 관리
 * @export
 * @class JdBucketRef
 * @implements {IBucketRef}
 */
export class JdBucketRef implements IBucketRef {
  constructor() {}
  protected containerRefMap: Map&lt;string, IBucketContainerRef> = new Map();
  protected subjectDragger: Subject&lt;BucketEvent> = new Subject();
  protected subjectRangeSelection: Subject&lt;BucketRangeSelectionEvent> = new Subject();
  protected draggingContainerRef: IBucketContainerRef | null = null;
  protected fallbackIndicate: boolean = false;

  /**
   * dnd 폴백을 사용하는지 여부
   * @readonly
   * @type {boolean}
   */
  get isFallbackIndicate(): boolean {
    return this.fallbackIndicate;
  }

  /**
   * dnd 폴백을 사용하는지 여부 지정.
   * 폴백을 사용하지 않는 다면 브라우저에서 기본으로 지원하는 드래그(중인 이미지) UI 를 사용하고,
   * 폴백을 사용한다면 DOM 을 이용하는데, draggable 에서 사용하는 폴백 DOM 을 invisible 처리하고,
   * draggable 대신 드래그 중인 UI 를 표시한다.
   * @param {boolean} is
   */
  setFallbackIndicate(is: boolean): void {
    this.fallbackIndicate = !!is;
  }

  /**
   *
   * 등록된 버킷 컨테이너 맵.
   * @returns {Map&lt;string, IBucketContainerRef>}
   */
  getContainerRefs(): Map&lt;string, IBucketContainerRef> {
    return this.containerRefMap;
  }

  /**
   * 옵저버: 드래그 상태
   * @returns {Observable&lt;BucketEvent>}
   */
  observeDragger(): Observable&lt;BucketEvent> {
    return this.subjectDragger.asObservable();
  }

  /**
   * 옵저버: 영역 선택기 상태
   * @returns {Observable&lt;BucketRangeSelectionEvent>}
   */
  observeRangeSelection(): Observable&lt;BucketRangeSelectionEvent> {
    return this.subjectRangeSelection.asObservable();
  }

  /**
   * 알림: 드래그 아이템 선택
   * @param {BucketDragChoose} params
   */
  dispatchDragChoose(params: BucketDragChoose): void {
    const { fromContainer, sortableEvent } = params;
    this.subjectDragger.next({
      type: BucketEventType.DRAG_CHOOSE,
      fromContainer,
      sortableEvent
    });
  }

  /**
   * 알림: 드래그 아이템 선택 해제
   * @param {BucketDragChoose} params
   */
  dispatchDragUnchoose(params: BucketDragChoose): void {
    const { sortableEvent } = params;
    this.subjectDragger.next({
      type: BucketEventType.DRAG_UNCHOOSE,
      sortableEvent
    });
  }

  /**
   * 알림: 드래그 시작
   * @param {BucketDragStart} params
   */
  dispatchDragStart(params: BucketDragStart): void {
    const { fromContainer, sortableEvent } = params;
    this.draggingContainerRef = fromContainer;
    this.subjectDragger.next({
      type: BucketEventType.DRAG_START,
      sortableEvent,
      fromContainer
    });
  }

  /**
   * 알림: 드래그 종료
   * @param {BucketDragEnd} params
   */
  dispatchDragEnd(params: BucketDragEnd): void {
    const { toContainer, sortableEvent } = params;
    const fromContainer = this.draggingContainerRef;
    this.subjectDragger.next({
      type: BucketEventType.DRAG_END,
      sortableEvent,
      fromContainer,
      toContainer
    });
    toContainer.dispatchDropped({
      sortableEvent,
      fromContainer: this.draggingContainerRef,
      toContainer: toContainer
    });
    this.draggingContainerRef = null;
  }

  /**
   * 알림: 영역 선택기 시작
   * @param {BucketRangeSelectionEvent} params
   */
  dispatchRangeSelectionStart(params: BucketRangeSelectionEvent): void {
    this.subjectRangeSelection.next(params);
  }

  /**
   * 버킷 컨테이너 등록
   * @param {IBucketContainerRef} containerRef
   */
  joinContainerRef(containerRef: IBucketContainerRef): void {
    this.containerRefMap.set(containerRef.getUid(), containerRef);
  }

  /**
   * 버킷 컨테이너 등록 해제
   * @param {IBucketContainerRef} containerRef
   */
  unjoinContainerRef(containerRef: IBucketContainerRef): void {
    this.containerRefMap.delete(containerRef.getUid());
  }

  /**
   * 해당 element(DOM) 가 속한 버킷 컨테이너 찾기
   * @param {Element} element
   * @returns {IBucketContainerRef}
   */
  findContainerRefByElement(element: Element): IBucketContainerRef {
    const finded = Array.from(this.containerRefMap.values()).find((ref: IBucketContainerRef) => {
      return ref.elContainer === element;
    }) as IBucketContainerRef;
    return finded;
  }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Tue Jul 14 2020 09:10:47 GMT+0000 (Coordinated Universal Time)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
